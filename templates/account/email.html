{% extends 'account/base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}
ویرایش ایمیل
{% endblock title %}


{% block content %}
<!-- Page -->
<div class="page main-signin-wrapper">

	<!-- Row -->
	<div class="row signpages text-center">
		<div class="col-md-12">
			<div class="card">
				<div class="row row-sm">
					{% include 'account/_messages.html' %}
					<h1>ایمیل‌ها</h1>
					{% if user.emailaddress_set.all %}
						<p>ایمیل‌های ثبت شده برای حساب شما</p>

						<form action="{% url 'account_email' %}" class="email_list" method="post">
						{% csrf_token %}
						<fieldset class="blockLabels">

						{% for emailaddress in user.emailaddress_set.all %}
						<div class="ctrlHolder">
							<label for="email_radio_{{forloop.counter}}" class="{% if emailaddress.primary %}primary_email{%endif%}">

							<input id="email_radio_{{forloop.counter}}" type="radio" name="email" {% if emailaddress.primary or user.emailaddress_set.count == 1 %}checked="checked"{%endif %} value="{{emailaddress.email}}"/>

						{{ emailaddress.email }}
							{% if emailaddress.verified %}
							<span class="text-success">ایمیل تایید شده</span>
							{% else %}
							<span class="text-danger">ایمیل تایید نشده</span>
							{% endif %}
							{% if emailaddress.primary %}<span class="text-primary">اصلی</span>{% endif %}
						</label>
						</div>
						{% endfor %}

						<div class="buttonHolder">
							<button class="btn btn-success" type="submit" name="action_primary" >در نظر گرفتن به عنوان ایمیل اصلی</button>
							<button class="btn btn-primary" type="submit" name="action_send" >درخواست ارسال ایمیل تاییدیه</button>
							<button class="btn btn-danger" type="submit" name="action_remove" >حذف ایمیل</button>
						</div>

						</fieldset>
						</form>

					{% else %}
						<p><strong>هشدار</strong> شما در حال حاضر هیچ ایمیلی برای حساب خود ثبت نکرده‌اید. برای دریافت نوتیفیکیشن‌ها، درخواست فراموشی رمز عبور و ... شما نیاز به ایمیل دارید، پس همین حالا ایمیل خود را ثبت نمایید.</p>
						
					{% endif %}

					{% if can_add_email %}
						<h2>اضافه کردن ایمیل جدید</h2>

						<form method="post" action="{% url 'account_email' %}" class="add_email">
							{% csrf_token %}
							{{ form.as_p }}
							<button name="action_add" type="submit">اضافه کردن</button>
						</form>
					{% endif %}
				</div>
			</div>
		</div>
	</div>
	<!-- End Row -->

</div>
<!-- End Page -->

<script type="text/javascript">
	(function() {
		var message = "آیا واقعا میخواهید این ایمیل را حذف کنید؟";
		var actions = document.getElementsByName('action_remove');
		if (actions.length) {
		actions[0].addEventListener("click", function(e) {
			if (! confirm(message)) {
			e.preventDefault();
			}
		});
		}
	})();
</script>
{% endblock content %}